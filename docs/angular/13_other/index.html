<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Angular 操作 DOM # ElementRef # ElementRef 是一个包装器，提供了对原生 DOM 元素的引用，通常是通过 @ViewChild 或 @ContentChild 来访问模板中的元素，但也可以直接注入 ElementRef 来操作宿主元素。
当你直接注入 ElementRef 时，Angular 会自动将组件或指令的宿主元素传递给你。你可以通过 ElementRef 访问宿主元素，并执行一些 DOM 操作：
import { Component, ElementRef, OnInit } from '@angular/core'; @Component({ selector: 'app-example', template: `<p>This is an example component!</p>` }) export class ExampleComponent implements OnInit { constructor(private elementRef: ElementRef) {} ngOnInit() { // 通过 ElementRef 访问宿主元素 console.log(this.elementRef.nativeElement); // 打印宿主元素 this.elementRef.nativeElement.style.backgroundColor = 'lightblue'; // 动态修改背景色 } } 直接注入 ElementRef 虽然可以直接通过 nativeElement 操作 DOM，但更推荐使用 Renderer2 来确保代码的跨平台兼容性、安全性和稳定性。"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="其他"><meta property="og:description" content="Angular 操作 DOM # ElementRef # ElementRef 是一个包装器，提供了对原生 DOM 元素的引用，通常是通过 @ViewChild 或 @ContentChild 来访问模板中的元素，但也可以直接注入 ElementRef 来操作宿主元素。
当你直接注入 ElementRef 时，Angular 会自动将组件或指令的宿主元素传递给你。你可以通过 ElementRef 访问宿主元素，并执行一些 DOM 操作：
import { Component, ElementRef, OnInit } from '@angular/core'; @Component({ selector: 'app-example', template: `<p>This is an example component!</p>` }) export class ExampleComponent implements OnInit { constructor(private elementRef: ElementRef) {} ngOnInit() { // 通过 ElementRef 访问宿主元素 console.log(this.elementRef.nativeElement); // 打印宿主元素 this.elementRef.nativeElement.style.backgroundColor = 'lightblue'; // 动态修改背景色 } } 直接注入 ElementRef 虽然可以直接通过 nativeElement 操作 DOM，但更推荐使用 Renderer2 来确保代码的跨平台兼容性、安全性和稳定性。"><meta property="og:type" content="article"><meta property="og:url" content="http://shipengqi.github.io/frontend-learn/docs/angular/13_other/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-12-08T20:10:16+08:00"><title>其他 | Frontend Learning</title><link rel=manifest href=/frontend-learn/manifest.json><link rel=icon href=/frontend-learn/favicon.png type=image/x-icon><link rel=stylesheet href=/frontend-learn/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/frontend-learn/flexsearch.min.js></script>
<script defer src=/frontend-learn/en.search.min.037765717c349e52e429233c20732dc8d721ceb6f1132b7c4c982cc2b219d302.js integrity="sha256-A3dlcXw0nlLkKSM8IHMtyNchzrbxEyt8TJgswrIZ0wI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/frontend-learn/><span>Frontend Learning</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://shipengqi.github.io/ target=_blank rel=noopener>Blog</a></li><li><a href=https://github.com/shipengqi/frontend-learn target=_blank rel=noopener>Github</a></li></ul><ul><li><a href=/frontend-learn/docs/html/>HTML 和 CSS</a><ul><li><a href=/frontend-learn/docs/html/01_tags/>HTML 标签</a></li><li><a href=/frontend-learn/docs/html/02_css/>CSS 常用属性</a></li><li><a href=/frontend-learn/docs/html/03_layout/>布局与定位</a></li><li><a href=/frontend-learn/docs/html/04_animation/>过渡和动画</a></li><li><a href=/frontend-learn/docs/html/05_other/>其他属性</a></li><li><a href=/frontend-learn/docs/html/06_selector/>CSS 选择器</a></li><li><a href=/frontend-learn/docs/html/07_responsive/>响应式</a></li><li><a href=/frontend-learn/docs/html/08_svg/>SVG</a></li><li><a href=/frontend-learn/docs/html/09_chrome/>Chrome 开发者工具</a></li></ul></li><li><span>RxJS</span><ul><li><a href=/frontend-learn/docs/rxjs/01_overview/>概念</a></li><li><a href=/frontend-learn/docs/rxjs/02_operators/>操作符</a></li><li><a href=/frontend-learn/docs/rxjs/03_subject/>Subject</a></li><li><a href=/frontend-learn/docs/rxjs/04_practice/>实践</a></li></ul></li><li><span>Angular</span><ul><li><a href=/frontend-learn/docs/angular/01_overview/>概述</a></li><li><a href=/frontend-learn/docs/angular/02_component/>组件模板</a></li><li><a href=/frontend-learn/docs/angular/03_communication/>组件通讯</a></li><li><a href=/frontend-learn/docs/angular/04_lifecycle/>组件生命周期</a></li><li><a href=/frontend-learn/docs/angular/05_directive/>指令</a></li><li><a href=/frontend-learn/docs/angular/06_pipe/>管道</a></li><li><a href=/frontend-learn/docs/angular/07_di/>依赖注入</a></li><li><a href=/frontend-learn/docs/angular/08_service/>服务</a></li><li><a href=/frontend-learn/docs/angular/09_form/>表单</a></li><li><a href=/frontend-learn/docs/angular/10_custom_form/>自定义表单控件</a></li><li><a href=/frontend-learn/docs/angular/11_router/>路由</a></li><li><a href=/frontend-learn/docs/angular/12_http/>HttpClient</a></li><li><a href=/frontend-learn/docs/angular/13_other/ class=active>其他</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/frontend-learn/svg/menu.svg class=book-icon alt=Menu></label>
<strong>其他</strong>
<label for=toc-control><img src=/frontend-learn/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#angular-操作-dom>Angular 操作 DOM</a><ul><li><a href=#elementref>ElementRef</a></li><li><a href=#viewref>ViewRef</a></li><li><a href=#viewcontainerref>ViewContainerRef</a><ul><li><a href=#动态创建组件>动态创建组件</a></li><li><a href=#动态插入模板>动态插入模板</a></li><li><a href=#条件渲染>条件渲染</a></li></ul></li><li><a href=#renderer2>Renderer2</a></li></ul></li><li><a href=#title>Title</a></li><li><a href=#meta>Meta</a></li><li><a href=#document>DOCUMENT</a></li><li><a href=#location>Location</a><ul><li><a href=#与-windowlocation-的区别>与 window.location 的区别</a></li></ul></li><li><a href=#ngzone>NgZone</a><ul><li><a href=#runoutsideangular>runOutsideAngular</a></li><li><a href=#run>run</a></li><li><a href=#onstable>onStable</a></li><li><a href=#haspendingmacrotasks-和-haspendingmicrotasks>hasPendingMacrotasks 和 hasPendingMicrotasks</a></li></ul></li><li><a href=#domsanitizer>DomSanitizer</a></li><li><a href=#attribute-装饰器>Attribute 装饰器</a></li><li><a href=#app_initializer>APP_INITIALIZER</a></li><li><a href=#environment_initializer>ENVIRONMENT_INITIALIZER</a></li><li><a href=#platform_initializer>PLATFORM_INITIALIZER</a></li><li><a href=#host-host-contextng-deep><code>:host</code> 、<code>:host-context</code>、<code>::ng-deep</code></a><ul><li><a href=#host><code>:host</code></a></li><li><a href=#host-context><code>:host-context</code></a></li><li><a href=#ng-deep><code>::ng-deep</code></a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=angular-操作-dom>Angular 操作 DOM
<a class=anchor href=#angular-%e6%93%8d%e4%bd%9c-dom>#</a></h1><h2 id=elementref>ElementRef
<a class=anchor href=#elementref>#</a></h2><p><code>ElementRef</code> 是一个包装器，提供了对原生 DOM 元素的引用，通常是通过 <code>@ViewChild</code> 或 <code>@ContentChild</code> 来访问模板中的元素，但也可以直接注入 <code>ElementRef</code> 来操作<strong>宿主元素</strong>。</p><p>当你直接注入 <code>ElementRef</code> 时，Angular 会自动将组件或指令的宿主元素传递给你。你可以通过 ElementRef 访问宿主元素，并执行一些 DOM 操作：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>ElementRef</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-example&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;p&gt;This is an example component!&lt;/p&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExampleComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>elementRef</span>: <span style=color:#66d9ef>ElementRef</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 通过 ElementRef 访问宿主元素
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>elementRef</span>.<span style=color:#a6e22e>nativeElement</span>); <span style=color:#75715e>// 打印宿主元素
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>elementRef</span>.<span style=color:#a6e22e>nativeElement</span>.<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>backgroundColor</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;lightblue&#39;</span>; <span style=color:#75715e>// 动态修改背景色
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>直接注入 <code>ElementRef</code> 虽然可以直接通过 <code>nativeElement</code> 操作 DOM，但更推荐使用 <code>Renderer2</code> 来确保代码的跨平台兼容性、安全性和稳定性。</p><h2 id=viewref>ViewRef
<a class=anchor href=#viewref>#</a></h2><p><code>ViewRef</code> 是 Angular 视图 (View) 的抽象。在 Angular 中，<code>View</code> 是应用程序的基本构建块。它是在一起被创建或者销毁的最小元素组单位。Angular 哲学鼓励开发者将 UI 界面
看作 View 的聚合。而不要看作标准的 HTML 元素树。</p><p>Angular 支持两种 View:</p><ul><li>Embedded View，指 <code>Template</code></li><li>Host View，指 <code>Component</code></li></ul><h2 id=viewcontainerref>ViewContainerRef
<a class=anchor href=#viewcontainerref>#</a></h2><p>用于动态地管理视图（View）的 Service。它允许你在运行时向应用程序中添加、移除或更改视图（模板），从而实现动态组件加载、条件渲染等功能。</p><h3 id=动态创建组件>动态创建组件
<a class=anchor href=#%e5%8a%a8%e6%80%81%e5%88%9b%e5%bb%ba%e7%bb%84%e4%bb%b6>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-dynamic&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;p&gt;This is a dynamically loaded component!&lt;/p&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DynamicComponent</span> {}
</span></span></code></pre></div><p>父组件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>ViewChild</span>, <span style=color:#a6e22e>ViewContainerRef</span>, <span style=color:#a6e22e>ComponentFactoryResolver</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DynamicComponent</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./dynamic.component&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-parent&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;ng-container #container&gt;&lt;/ng-container&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ParentComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;container&#39;</span>, { <span style=color:#a6e22e>read</span>: <span style=color:#66d9ef>ViewContainerRef</span> }) <span style=color:#a6e22e>container</span>: <span style=color:#66d9ef>ViewContainerRef</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>componentFactoryResolver</span>: <span style=color:#66d9ef>ComponentFactoryResolver</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 创建并插入动态组件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>componentFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>componentFactoryResolver</span>.<span style=color:#a6e22e>resolveComponentFactory</span>(<span style=color:#a6e22e>DynamicComponent</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>clear</span>();  <span style=color:#75715e>// 清除之前的视图（如果有的话）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>createComponent</span>(<span style=color:#a6e22e>componentFactory</span>);  <span style=color:#75715e>// 动态加载组件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol><li>使用 <code>@ViewChild('container', { read: ViewContainerRef })</code> 获取 <code>ViewContainerRef</code>。</li><li>通过 <code>ComponentFactoryResolver</code> 创建 <code>DynamicComponent</code> 的工厂，并使用 <code>ViewContainerRef</code> 将组件插入视图。</li><li><code>clear()</code> 方法用于清除容器中的所有现有视图（可选，防止插入多个相同组件）。</li></ol><h3 id=动态插入模板>动态插入模板
<a class=anchor href=#%e5%8a%a8%e6%80%81%e6%8f%92%e5%85%a5%e6%a8%a1%e6%9d%bf>#</a></h3><p><code>ViewContainerRef</code> 还可以与 <code>TemplateRef</code> 配合使用，用于动态插入模板。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>ViewChild</span>, <span style=color:#a6e22e>ViewContainerRef</span>, <span style=color:#a6e22e>TemplateRef</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-parent&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;ng-template #template&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;p&gt;This is a dynamically inserted template!&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/ng-template&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;ng-container #container&gt;&lt;/ng-container&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  `</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ParentComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;container&#39;</span>, { <span style=color:#a6e22e>read</span>: <span style=color:#66d9ef>ViewContainerRef</span> }) <span style=color:#a6e22e>container</span>: <span style=color:#66d9ef>ViewContainerRef</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;template&#39;</span>) <span style=color:#a6e22e>template</span>: <span style=color:#66d9ef>TemplateRef</span>&lt;<span style=color:#f92672>any</span>&gt;;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 动态插入模板
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>createEmbeddedView</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>template</span>); 
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=条件渲染>条件渲染
<a class=anchor href=#%e6%9d%a1%e4%bb%b6%e6%b8%b2%e6%9f%93>#</a></h3><p><code>ViewContainerRef</code> 可以通过动态加载组件和模板来实现条件渲染。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>ViewChild</span>, <span style=color:#a6e22e>ViewContainerRef</span>, <span style=color:#a6e22e>ComponentFactoryResolver</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DynamicComponent</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./dynamic.component&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-parent&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;button (click)=&#34;toggleComponent()&#34;&gt;Toggle Component&lt;/button&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;ng-container #container&gt;&lt;/ng-container&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  `</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ParentComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;container&#39;</span>, { <span style=color:#a6e22e>read</span>: <span style=color:#66d9ef>ViewContainerRef</span> }) <span style=color:#a6e22e>container</span>: <span style=color:#66d9ef>ViewContainerRef</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>componentCreated</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>componentFactoryResolver</span>: <span style=color:#66d9ef>ComponentFactoryResolver</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ngOnInit() {</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>toggleComponent() {</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>componentCreated</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>clear</span>();  <span style=color:#75715e>// 移除组件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>componentCreated</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>componentFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>componentFactoryResolver</span>.<span style=color:#a6e22e>resolveComponentFactory</span>(<span style=color:#a6e22e>DynamicComponent</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>createComponent</span>(<span style=color:#a6e22e>componentFactory</span>);  <span style=color:#75715e>// 动态创建组件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>componentCreated</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在上面的代码中：</p><ul><li>点击按钮会动态插入或删除 <code>DynamicComponent</code>。</li><li>通过 <code>ViewContainerRef.clear()</code> 方法移除组件或视图。</li></ul><h2 id=renderer2>Renderer2
<a class=anchor href=#renderer2>#</a></h2><p><code>Renderer2</code> 是一个用于与 DOM 进行交互的服务，它提供了一些安全的、平台无关的 API 来操作 DOM 元素。</p><p><code>Renderer2</code> 的主要目的是提供跨平台的兼容性，使得 Angular 应用可以在浏览器、服务器端渲染（Angular Universal）等环境下正常工作，同时也提高了代码的安全性（例如避免直接操作 DOM 引发 XSS 攻击）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>Renderer2</span>, <span style=color:#a6e22e>ElementRef</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-example&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>templateUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./example.component.html&#39;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExampleComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>renderer</span>: <span style=color:#66d9ef>Renderer2</span>, <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>el</span>: <span style=color:#66d9ef>ElementRef</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 使用 Renderer2 操作 DOM
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><p><code>setProperty</code>：用于设置指定元素的属性，第二个参数是要设置的值。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>setProperty</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>nativeElement</span>, <span style=color:#e6db74>&#39;textContent&#39;</span>, <span style=color:#e6db74>&#39;Hello World!&#39;</span>);
</span></span></code></pre></div></li><li><p><code>setStyle</code>：用于设置元素的样式，第一个参数是 DOM 元素，第二个参数是 CSS 属性名称，第三个参数是样式的值。</p></li><li><p><code>removeStyle</code>：移除元素的指定样式。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>setStyle</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>nativeElement</span>, <span style=color:#e6db74>&#39;color&#39;</span>, <span style=color:#e6db74>&#39;red&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>removeStyle</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>nativeElement</span>, <span style=color:#e6db74>&#39;color&#39;</span>);
</span></span></code></pre></div></li><li><p><code>addClass</code>：给元素添加指定的 CSS 类。</p></li><li><p><code>removeClass</code>：从元素中移除指定的 CSS 类。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>addClass</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>nativeElement</span>, <span style=color:#e6db74>&#39;highlight&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>removeClass</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>nativeElement</span>, <span style=color:#e6db74>&#39;highlight&#39;</span>);
</span></span></code></pre></div></li><li><p><code>listen</code>：用于监听 DOM 事件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>unsubscribe</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>nativeElement</span>, <span style=color:#e6db74>&#39;click&#39;</span>, (<span style=color:#a6e22e>event</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Element clicked&#39;</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div></li><li><p><code>createElement</code>：用于创建一个 DOM 元素。</p></li><li><p><code>createText</code>：用于创建一个文本节点。</p></li><li><p><code>appendChild</code>：用于将子元素添加到父元素。</p></li><li><p><code>removeChild</code>：`方法，用于从父元素中移除子元素。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>div</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;div&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>createText</span>(<span style=color:#e6db74>&#39;Hello Renderer2!&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>div</span>, <span style=color:#a6e22e>text</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>nativeElement</span>, <span style=color:#a6e22e>div</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>renderer</span>.<span style=color:#a6e22e>removeChild</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>el</span>.<span style=color:#a6e22e>nativeElement</span>, <span style=color:#a6e22e>div</span>);
</span></span></code></pre></div></li></ul><h1 id=title>Title
<a class=anchor href=#title>#</a></h1><p>Title 标签是一个 HTML 元素，用于指定网页标题。Title 标签作为给定结果的可点击标题，显示在搜索引擎结果页面（SERP）上。它们对于可用性、SEO 和社交共享而言至关重要。</p><p>Angular 在 <code>@angular/platform-browser</code> 中有一个 <code>Title</code> 服务。只需将 <code>Title</code> 服务注入到组件中，然后使用 <code>setTitle</code> 方法设置标题。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Title</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@angular/platform-browser&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>Title</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>title</span>.<span style=color:#a6e22e>setTitle</span>(<span style=color:#e6db74>&#34;Login&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=meta>Meta
<a class=anchor href=#meta>#</a></h1><p>Angular 在 <code>@angular/platform-browser</code> 中有一个 <code>Meta</code> 服务，使我们能够从组件中设置 <code>meta</code> 标签。</p><p>Meta 元素提供有关网页的信息，搜索引擎可以在这些信息的帮助下正确地分类网页。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Meta</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@angular/platform-browser&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BlogComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>meta</span>: <span style=color:#66d9ef>Meta</span>) {}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>updateTag</span>({<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;title&#34;</span>, <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>})
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>updateTag</span>({<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;description&#34;</span>, <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Lorem ipsum dolor&#34;</span>})
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>updateTag</span>({<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;image&#34;</span>, <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;./assets/blog-image.jpg&#34;</span>})
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>updateTag</span>({<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;site&#34;</span>, <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;My Site&#34;</span>})
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=document>DOCUMENT
<a class=anchor href=#document>#</a></h1><p><code>DOCUMENT</code> 是一个注入令牌（token），它是一个用于获取和操作浏览器 <code>document</code> 对象的服务。直接使用 <code>window.document</code> 只能在浏览器环境中工作，而 Angular 提供的 <code>DOCUMENT</code> 是通过依赖注入来提供的，可以在浏览器和其他环境（如服务器端渲染）之间自动适配。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>Inject</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DOCUMENT</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/common&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-document-example&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;h1&gt;Check the document title in the console!&lt;/h1&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DocumentExampleComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>@Inject</span>(<span style=color:#a6e22e>DOCUMENT</span>) <span style=color:#66d9ef>private</span> document<span style=color:#f92672>:</span> <span style=color:#a6e22e>Document</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 访问和操作 document 对象
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Document title:&#39;</span>, <span style=color:#66d9ef>this</span>.document.<span style=color:#a6e22e>title</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.document.<span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;New Document Title&#39;</span>; <span style=color:#75715e>// 修改文档标题
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=location>Location
<a class=anchor href=#location>#</a></h1><p><code>Location</code> 是一个提供访问和操作浏览器 URL 的服务。它允许在不重新加载页面的情况下操作浏览器的历史记录和 URL。这使得你能够在单页面应用（SPA）中实现 URL 路由和导航，同时避免浏览器刷新。</p><p>不要直接修改 <code>window.location</code>，使用 <code>Location</code> 或 <code>Router</code> 来保证跨平台兼容性。并且 <code>Location</code> 支持服务端渲染（SSR），可以在 Node.js 环境中模拟操作。</p><h2 id=与-windowlocation-的区别>与 window.location 的区别
<a class=anchor href=#%e4%b8%8e-windowlocation-%e7%9a%84%e5%8c%ba%e5%88%ab>#</a></h2><table><thead><tr><th>功能</th><th>Angular <code>Location</code></th><th><code>window.location</code></th></tr></thead><tbody><tr><td>修改 URL</td><td>可以修改 URL，不会刷新页面</td><td>修改 URL 时通常会导致页面刷新</td></tr><tr><td>支持单页面应用（SPA）</td><td>是专为单页面应用设计的工具</td><td>通常用于传统的页面导航和跳转</td></tr><tr><td>操作历史记录</td><td>提供 <code>back</code> 和 <code>forward</code> 方法</td><td>使用 <code>history.back()</code> 等实现</td></tr><tr><td>获取和解析 URL</td><td>提供 <code>path()</code> 等方法获取路径部分</td><td>提供 <code>window.location.pathname</code> 等</td></tr><tr><td>不触发页面刷新</td><td>支持通过 <code>go()</code> 和 <code>replaceState()</code> 修改 URL 而不刷新页面</td><td>大部分操作都会导致页面刷新</td></tr></tbody></table><p>适用场景：</p><table><thead><tr><th>场景</th><th>Angular <code>Location</code></th><th><code>window.location</code></th></tr></thead><tbody><tr><td>单页面应用（SPA）</td><td>推荐使用，用于导航和历史记录管理</td><td>不推荐，会导致页面刷新</td></tr><tr><td>传统页面跳转</td><td>不适用</td><td>推荐使用</td></tr><tr><td>操作浏览器历史记录</td><td>提供方便的方法，如 <code>back()</code>、<code>forward()</code></td><td>可以通过 <code>window.history</code> 操作</td></tr><tr><td>URL 操作与刷新行为</td><td>不刷新页面，适合动态导航</td><td>大多数情况下刷新页面</td></tr></tbody></table><h1 id=ngzone>NgZone
<a class=anchor href=#ngzone>#</a></h1><p><code>NgZone</code> 是 Angular 提供的一个服务，用于与 Angular 的变更检测机制进行交互，帮助你控制异步操作和变更检测的行为。</p><p><code>NgZone</code> 允许你在执行异步操作时明确控制是否触发变更检测，避免不必要的性能开销。</p><p><code>NgZone</code> 是 Angular 基于 zone.js 库的一个封装，zone.js 是一个 JavaScript 库，帮助开发者追踪异步任务的执行。通过 <code>NgZone</code>，Angular 可以追踪和管理异步任务（如定时器、HTTP 请求、用户输入事件等），并确保这些任务在执行后会触发 Angular 的变更检测机制。</p><h2 id=runoutsideangular>runOutsideAngular
<a class=anchor href=#runoutsideangular>#</a></h2><p>函数 <code>runOutsideAngular</code> 内执行的代码不会触发变更检测。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>NgZone</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-ngzone-example&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;h1&gt;{{ message }}&lt;/h1&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NgZoneExampleComponent</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Hello&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>ngZone</span>: <span style=color:#66d9ef>NgZone</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>startLongRunningTask() {</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 在 Angular Zone 外部运行代码，不触发变更检测
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ngZone</span>.<span style=color:#a6e22e>runOutsideAngular</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>setInterval</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// 假设这是一个非常频繁的操作
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Running outside Angular zone&#39;</span>);
</span></span><span style=display:flex><span>            }, <span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=run>run
<a class=anchor href=#run>#</a></h2><p><code>run</code> 方法的目的与 <code>runOutsideAngular</code> 正好相反。任何写在 <code>run</code> 里的方法，都会进入 Angular Zone 的管辖范围，确保变更检测被触发。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>NgZone</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-ngzone-example&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;h1&gt;{{ message }}&lt;/h1&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NgZoneExampleComponent</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Hello&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>ngZone</span>: <span style=color:#66d9ef>NgZone</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updateMessage() {</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 在 Angular Zone 内运行，确保变更检测被触发
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ngZone</span>.<span style=color:#a6e22e>run</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Updated Message&#39;</span>;
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=onstable>onStable
<a class=anchor href=#onstable>#</a></h2><p><code>onStable</code>：是一个 Observable，它会在 Angular 完成所有异步任务并且变更检测稳定后触发。这在需要确保所有变更检测已经完成之后执行某些操作时非常有用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>NgZone</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-ngzone-example&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;h1&gt;{{ message }}&lt;/h1&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NgZoneExampleComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Hello&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>ngZone</span>: <span style=color:#66d9ef>NgZone</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 监听 Angular Zone 的稳定事件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ngZone</span>.<span style=color:#a6e22e>onStable</span>.<span style=color:#a6e22e>subscribe</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;All asynchronous tasks have completed.&#39;</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=haspendingmacrotasks-和-haspendingmicrotasks>hasPendingMacrotasks 和 hasPendingMicrotasks
<a class=anchor href=#haspendingmacrotasks-%e5%92%8c-haspendingmicrotasks>#</a></h2><p><code>hasPendingMacrotasks</code> 和 <code>hasPendingMicrotasks</code> 用于检查 Angular Zone 内是否还有待处理的宏任务和微任务。这在调试时可以非常有用，帮助你确定是否还有异步任务在执行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>NgZone</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-ngzone-example&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;h1&gt;{{ message }}&lt;/h1&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NgZoneExampleComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>message</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Hello&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>ngZone</span>: <span style=color:#66d9ef>NgZone</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ngOnInit() {</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Has pending macro tasks:&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ngZone</span>.<span style=color:#a6e22e>hasPendingMacrotasks</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Has pending micro tasks:&#39;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>ngZone</span>.<span style=color:#a6e22e>hasPendingMicrotasks</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=domsanitizer>DomSanitizer
<a class=anchor href=#domsanitizer>#</a></h1><p>用于帮助开发者安全地处理动态 HTML、样式、URL、资源等。它的主要作用是防止 跨站脚本攻击（XSS），通过对可能不安全的内容进行清理和消毒，确保它们在渲染时不会带来安全风险。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DomSanitizer</span>, <span style=color:#a6e22e>SafeHtml</span>, <span style=color:#a6e22e>SafeStyle</span>, <span style=color:#a6e22e>SafeUrl</span>, <span style=color:#a6e22e>SafeResourceUrl</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/platform-browser&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-example&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;div [innerHTML]=&#34;trustedHtml&#34;&gt;&lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;img [src]=&#34;trustedUrl&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  `</span>,
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExampleComponent</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>trustedHtml</span>: <span style=color:#66d9ef>SafeHtml</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>trustedUrl</span>: <span style=color:#66d9ef>SafeUrl</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>sanitizer</span>: <span style=color:#66d9ef>DomSanitizer</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 使用 DomSanitizer 处理不安全的内容
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>trustedHtml</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sanitizer</span>.<span style=color:#a6e22e>bypassSecurityTrustHtml</span>(<span style=color:#e6db74>&#39;&lt;p&gt;Unsafe HTML content&lt;/p&gt;&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>trustedUrl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sanitizer</span>.<span style=color:#a6e22e>bypassSecurityTrustUrl</span>(<span style=color:#e6db74>&#39;javascript:alert(&#34;XSS Attack&#34;)&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>DomSanitizer</code> 常用方法：</p><ul><li><p><code>bypassSecurityTrustHtml</code>：将不安全的 HTML 内容标记为“可信”，以便 Angular 渲染。这个方法通常用于插入动态 HTML 内容。</p></li><li><p><code>bypassSecurityTrustUrl</code>：将 URL 标记为可信的 URL，通常用于动态绑定 href、src 或其他需要 URL 的属性。</p></li><li><p><code>bypassSecurityTrustStyle</code>：将 CSS 样式标记为可信，允许动态添加不安全的样式到组件中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>DomSanitizer</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/platform-browser&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExampleComponent</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>sanitizer</span>: <span style=color:#66d9ef>DomSanitizer</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>getTrustedStyle() {</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>unsafeStyle</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;background-color: red;&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sanitizer</span>.<span style=color:#a6e22e>bypassSecurityTrustStyle</span>(<span style=color:#a6e22e>unsafeStyle</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><code>bypassSecurityTrustResourceUrl</code>：用于将不安全的资源 URL（如 <code>iframe</code> 的 src）标记为可信资源。可以用于动态加载嵌入式资源（如视频、音频等）。</p></li></ul><h1 id=attribute-装饰器>Attribute 装饰器
<a class=anchor href=#attribute-%e8%a3%85%e9%a5%b0%e5%99%a8>#</a></h1><p><code>@Attribute</code> 装饰器用于读取宿主元素的属性，而不是组件或指令的输入属性。 它主要用于访问那些静态的 HTML 属性（如 <code>id</code>, <code>class</code>, <code>aria-label</code> 等），并且这些属性是直接应用在宿主元素上的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>app-example</span> <span style=color:#a6e22e>data-id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;12345&#34;</span>&gt;&lt;/<span style=color:#f92672>app-example</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>Attribute</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-example&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;p&gt;{{ dataId }}&lt;/p&gt;`</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExampleComponent</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>@Attribute</span>(<span style=color:#e6db74>&#39;data-id&#39;</span>) <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>dataId</span>: <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Data ID:&#39;</span>, <span style=color:#a6e22e>dataId</span>); <span style=color:#75715e>// 12345
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=app_initializer>APP_INITIALIZER
<a class=anchor href=#app_initializer>#</a></h1><p>有时候我们需要在 Angular 应用启动时运行一段代码，这段代码可能会加载一些设置，比如加载缓存，加载配置。可以使用 <code>APP_INITIALIZER</code>。</p><p><code>APP_INITIALIZER</code>：初始化应用时执行的函数。如果这些函数中的任何一个返回一个 <code>Promise</code> 或 <code>Observable</code>，初始化就不会完成，直到 <code>Promise</code> 被解析或 <code>Observable</code> 被完成。</p><p>只需要 <code>AppModule</code> 中添加 <code>APP_INITIALIZER</code> 即可：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>runSettingsOnInit() {</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@NgModule</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        { <span style=color:#a6e22e>provide</span>: <span style=color:#66d9ef>APP_INITIALIZER</span>, <span style=color:#a6e22e>useFactory</span>: <span style=color:#66d9ef>runSettingsOnInit</span> }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><h1 id=environment_initializer>ENVIRONMENT_INITIALIZER
<a class=anchor href=#environment_initializer>#</a></h1><p><code>ENVIRONMENT_INITIALIZER</code> 是 Angular 14 引入的，用于在 Angular 应用启动期间运行长时间任务。它允许开发者在环境注入器中注入一个或多个初始化函数，这些函数在环境准备阶段执行。这个特性特别适用于那些需要在应用程序启动时完成的初始化工作，但又不适合放在 <code>APP_INITIALIZER</code> 中执行的场景。比如设置全局的服务或配置，这些工作通常需要在应用程序完全启动之前完成。</p><p>提高应用性能：通过在环境级别进行初始化，可以减少应用启动时的延迟，因为这些初始化任务可以在应用程序完全启动之前完成，从而提高应用的性能和响应速度。</p><h1 id=platform_initializer>PLATFORM_INITIALIZER
<a class=anchor href=#platform_initializer>#</a></h1><p><code>PLATFORM_INITIALIZER</code> 是用于初始化 Angular 平台的机制。这个机制允许开发者在 Angular 平台（例如在浏览器中）完全启动之前执行一些初始化逻辑。</p><p><code>PLATFORM_INITIALIZER</code> 通常用于执行那些需要在 Angular 平台完全启动之前完成的初始化任务，比如设置全局的提供者和服务。这个初始化器与 <code>APP_INITIALIZER</code> 和 <code>ENVIRONMENT_INITIALIZER</code> 的主要区别在于它的执行时机和作用范围，它更侧重于平台级别的初始化。</p><h1 id=host-host-contextng-deep><code>:host</code> 、<code>:host-context</code>、<code>::ng-deep</code>
<a class=anchor href=#host-host-contextng-deep>#</a></h1><h2 id=host><code>:host</code>
<a class=anchor href=#host>#</a></h2><p><code>:host</code> 是一个伪类选择器，用于选中当前组件的宿主元素（即 <code>&lt;my-component>&lt;/my-component></code>）。它可以用于定义组件根元素的样式。该选择器允许你从组件的样式文件中访问组件外部的宿主元素，而不是组件内部的子元素。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- my-component.component.html --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;inner&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>p</span>&gt;Content inside component&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span></code></pre></div><p>在组件的样式中，使用 <code>:host</code> 来修改宿主元素的样式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#75715e>/* my-component.component.css */</span>
</span></span><span style=display:flex><span>:<span style=color:#a6e22e>host</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>block</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>border</span>: <span style=color:#ae81ff>1</span><span style=color:#66d9ef>px</span> <span style=color:#66d9ef>solid</span> <span style=color:#66d9ef>red</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>padding</span>: <span style=color:#ae81ff>20</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>:<span style=color:#a6e22e>host</span><span style=color:#f92672>(</span>.<span style=color:#a6e22e>highlight</span><span style=color:#f92672>)</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-color</span>: <span style=color:#66d9ef>yellow</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在这个例子中 <code>:host</code> 选择器作用于组件的宿主元素 <code>&lt;my-component>&lt;/my-component></code>。</p><ul><li><code>:host</code> 只能影响宿主元素（组件标签）。</li><li>适用于修改组件根元素的样式。</li></ul><h2 id=host-context><code>:host-context</code>
<a class=anchor href=#host-context>#</a></h2><p><code>:host-context</code> 是另一个伪类选择器，作用于宿主元素及其外部上下文。它允许你根据宿主元素的外部环境（即外部父组件或全局样式）来修改组件的样式。</p><p><code>:host-context</code> 选择器类似于 <code>:host</code>，但它可以应用样式时依赖宿主元素的某些父元素的样式或类。</p><p>示例，一个父组件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>&lt;!</span><span style=color:#f92672>--</span> <span style=color:#f92672>parent</span>.<span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>html</span> <span style=color:#f92672>--</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#f92672>app-my-component</span> <span style=color:#f92672>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;special&#34;</span><span style=color:#f92672>&gt;&lt;/</span><span style=color:#f92672>app-my-component</span><span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>在 <code>MyComponent</code> 的样式中：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#75715e>/* my-component.component.css */</span>
</span></span><span style=display:flex><span>:<span style=color:#a6e22e>host-context</span><span style=color:#f92672>(</span>.<span style=color:#a6e22e>special</span><span style=color:#f92672>)</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-color</span>: <span style=color:#66d9ef>lightblue</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>:<span style=color:#a6e22e>host-context</span><span style=color:#f92672>(</span>.<span style=color:#a6e22e>another-class</span><span style=color:#f92672>)</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>background-color</span>: <span style=color:#66d9ef>lightgreen</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在这个例子中：</p><ul><li>当 <code>app-my-component</code> 的外部元素（父元素）有 <code>special</code> 类时，<code>MyComponent</code> 会获得 <code>background-color: lightblue</code> 的样式。</li><li>当父元素有 <code>another-class</code> 时，<code>background-color</code> 会变为 <code>lightgreen</code>。</li></ul><h2 id=ng-deep><code>::ng-deep</code>
<a class=anchor href=#ng-deep>#</a></h2><p><code>::ng-deep</code> 是一个 Angular 特有的伪类选择器，用于穿透组件的样式封装，允许你修改子组件或深层子元素的样式，即使这些子元素位于封装的视图中。</p><p>由于 Angular 使用的是 视图封装（View Encapsulation），通常，组件的样式只会影响该组件内部的元素，不会影响到其子组件或外部元素。<code>::ng-deep</code> 允许你突破这种封装，<strong>影响子组件内部的样式</strong>。</p><p>示例：一个子组件 <code>ChildComponent</code>，并且你想在父组件中修改 <code>ChildComponent</code> 的样式。可以使用 <code>::ng-deep</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- parent.component.html --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>app-child</span>&gt;&lt;/<span style=color:#f92672>app-child</span>&gt;
</span></span></code></pre></div><p>在父组件的样式中：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#75715e>/* parent.component.css */</span>
</span></span><span style=display:flex><span>::<span style=color:#a6e22e>ng-deep</span> <span style=color:#f92672>app-child</span> .<span style=color:#a6e22e>child-element</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>color</span>: <span style=color:#66d9ef>red</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>即使 <code>app-child</code> 有自己的封装样式，父组件仍然可以通过 <code>::ng-deep</code> 来修改 <code>app-child</code> 内部的 <code>.child-element</code> 元素的样式。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/shipengqi/frontend-learn/commit/ec85cf9388ebb2878f63a5754d61076147d90f6b title='Last modified by shipengqi | December 8, 2024' target=_blank rel=noopener><img src=/frontend-learn/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 8, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/shipengqi/frontend-learn/edit/master/content/docs/angular/13_other.md target=_blank rel=noopener><img src=/frontend-learn/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#angular-操作-dom>Angular 操作 DOM</a><ul><li><a href=#elementref>ElementRef</a></li><li><a href=#viewref>ViewRef</a></li><li><a href=#viewcontainerref>ViewContainerRef</a><ul><li><a href=#动态创建组件>动态创建组件</a></li><li><a href=#动态插入模板>动态插入模板</a></li><li><a href=#条件渲染>条件渲染</a></li></ul></li><li><a href=#renderer2>Renderer2</a></li></ul></li><li><a href=#title>Title</a></li><li><a href=#meta>Meta</a></li><li><a href=#document>DOCUMENT</a></li><li><a href=#location>Location</a><ul><li><a href=#与-windowlocation-的区别>与 window.location 的区别</a></li></ul></li><li><a href=#ngzone>NgZone</a><ul><li><a href=#runoutsideangular>runOutsideAngular</a></li><li><a href=#run>run</a></li><li><a href=#onstable>onStable</a></li><li><a href=#haspendingmacrotasks-和-haspendingmicrotasks>hasPendingMacrotasks 和 hasPendingMicrotasks</a></li></ul></li><li><a href=#domsanitizer>DomSanitizer</a></li><li><a href=#attribute-装饰器>Attribute 装饰器</a></li><li><a href=#app_initializer>APP_INITIALIZER</a></li><li><a href=#environment_initializer>ENVIRONMENT_INITIALIZER</a></li><li><a href=#platform_initializer>PLATFORM_INITIALIZER</a></li><li><a href=#host-host-contextng-deep><code>:host</code> 、<code>:host-context</code>、<code>::ng-deep</code></a><ul><li><a href=#host><code>:host</code></a></li><li><a href=#host-context><code>:host-context</code></a></li><li><a href=#ng-deep><code>::ng-deep</code></a></li></ul></li></ul></nav></div></aside></main></body></html>