<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="自定义表单控件 # 创建自定义表单控件时，通常需要三步：
实现 ControlValueAccessor 接口：使自定义控件能够与 Angular 表单框架配合使用。 实现 Validator 接口：提供自定义的验证逻辑。 注册自定义控件为 Angular 表单控件。 实现 ControlValueAccessor 接口 # ControlValueAccessor 接口允许自定义控件与 Angular 的表单控件（FormControl, ngModel）进行交互。需要实现以下方法：
writeValue(value: any): void：这个方法会将父组件的表单值写入自定义控件。 registerOnChange(fn: any): void：当自定义控件的值发生变化时，调用该方法通知父组件。 registerOnTouched(fn: any): void：当控件被触摸时（比如失去焦点），会调用这个方法通知父组件。通常来说，将 onBlur() 事件会绑定到控件的 blur 事件上，并在 onBlur() 方法中调用它。。 setDisabledState(isDisabled: boolean): void：用于设置控件的禁用状态。可以根据 isDisabled 值来禁用或启用自定义控件。 writeValue 和 setDisabledState 通常在父组件中调用 CustomFormControl.setValue() 和 CustomFormControl.disable() 方法时会执行。父组件初始化控件时也会执行，例如：
this.myCustomCtrl = new FormControl({value: '', disabled: true}); 实现 ControlValueAccessor 接口示例：
import { Component, forwardRef } from '@angular/core'; import { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms'; @Component({ selector: 'app-custom-input', template: `<input [value]=&#34;value&#34; (input)=&#34;onInput($event)&#34; />`, providers: [ { provide: NG_VALUE_ACCESSOR, // 注册到 Angular 表单系统 useExisting: forwardRef(() => CustomInputComponent), // 指向当前组件 multi: true // 表示可以有多个实现 } ] }) export class CustomInputComponent implements ControlValueAccessor { value: string = ''; onChange: any = () => {}; onTouched: any = () => {}; // 实现 ControlValueAccessor 接口 registerOnChange(fn: any): void { this."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="自定义表单控件"><meta property="og:description" content="自定义表单控件 # 创建自定义表单控件时，通常需要三步：
实现 ControlValueAccessor 接口：使自定义控件能够与 Angular 表单框架配合使用。 实现 Validator 接口：提供自定义的验证逻辑。 注册自定义控件为 Angular 表单控件。 实现 ControlValueAccessor 接口 # ControlValueAccessor 接口允许自定义控件与 Angular 的表单控件（FormControl, ngModel）进行交互。需要实现以下方法：
writeValue(value: any): void：这个方法会将父组件的表单值写入自定义控件。 registerOnChange(fn: any): void：当自定义控件的值发生变化时，调用该方法通知父组件。 registerOnTouched(fn: any): void：当控件被触摸时（比如失去焦点），会调用这个方法通知父组件。通常来说，将 onBlur() 事件会绑定到控件的 blur 事件上，并在 onBlur() 方法中调用它。。 setDisabledState(isDisabled: boolean): void：用于设置控件的禁用状态。可以根据 isDisabled 值来禁用或启用自定义控件。 writeValue 和 setDisabledState 通常在父组件中调用 CustomFormControl.setValue() 和 CustomFormControl.disable() 方法时会执行。父组件初始化控件时也会执行，例如：
this.myCustomCtrl = new FormControl({value: '', disabled: true}); 实现 ControlValueAccessor 接口示例：
import { Component, forwardRef } from '@angular/core'; import { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms'; @Component({ selector: 'app-custom-input', template: `<input [value]=&#34;value&#34; (input)=&#34;onInput($event)&#34; />`, providers: [ { provide: NG_VALUE_ACCESSOR, // 注册到 Angular 表单系统 useExisting: forwardRef(() => CustomInputComponent), // 指向当前组件 multi: true // 表示可以有多个实现 } ] }) export class CustomInputComponent implements ControlValueAccessor { value: string = ''; onChange: any = () => {}; onTouched: any = () => {}; // 实现 ControlValueAccessor 接口 registerOnChange(fn: any): void { this."><meta property="og:type" content="article"><meta property="og:url" content="http://shipengqi.github.io/frontend-learn/docs/angular/10_custom_form/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-12-08T16:28:03+08:00"><title>自定义表单控件 | Frontend Learning</title><link rel=manifest href=/frontend-learn/manifest.json><link rel=icon href=/frontend-learn/favicon.png type=image/x-icon><link rel=stylesheet href=/frontend-learn/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/frontend-learn/flexsearch.min.js></script>
<script defer src=/frontend-learn/en.search.min.037765717c349e52e429233c20732dc8d721ceb6f1132b7c4c982cc2b219d302.js integrity="sha256-A3dlcXw0nlLkKSM8IHMtyNchzrbxEyt8TJgswrIZ0wI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/frontend-learn/><span>Frontend Learning</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://shipengqi.github.io/ target=_blank rel=noopener>Blog</a></li><li><a href=https://github.com/shipengqi/frontend-learn target=_blank rel=noopener>Github</a></li></ul><ul><li><a href=/frontend-learn/docs/html/>HTML 和 CSS</a><ul><li><a href=/frontend-learn/docs/html/01_tags/>HTML 标签</a></li><li><a href=/frontend-learn/docs/html/02_css/>CSS 常用属性</a></li><li><a href=/frontend-learn/docs/html/03_layout/>布局与定位</a></li><li><a href=/frontend-learn/docs/html/04_animation/>过渡和动画</a></li><li><a href=/frontend-learn/docs/html/05_other/>其他属性</a></li><li><a href=/frontend-learn/docs/html/06_selector/>CSS 选择器</a></li><li><a href=/frontend-learn/docs/html/07_responsive/>响应式</a></li><li><a href=/frontend-learn/docs/html/08_svg/>SVG</a></li><li><a href=/frontend-learn/docs/html/09_chrome/>Chrome 开发者工具</a></li></ul></li><li><span>RxJS</span><ul><li><a href=/frontend-learn/docs/rxjs/01_overview/>概念</a></li><li><a href=/frontend-learn/docs/rxjs/02_operators/>操作符</a></li><li><a href=/frontend-learn/docs/rxjs/03_subject/>Subject</a></li><li><a href=/frontend-learn/docs/rxjs/04_practice/>实践</a></li></ul></li><li><span>Angular</span><ul><li><a href=/frontend-learn/docs/angular/01_overview/>概述</a></li><li><a href=/frontend-learn/docs/angular/02_component/>组件模板</a></li><li><a href=/frontend-learn/docs/angular/03_communication/>组件通讯</a></li><li><a href=/frontend-learn/docs/angular/04_lifecycle/>组件生命周期</a></li><li><a href=/frontend-learn/docs/angular/05_directive/>指令</a></li><li><a href=/frontend-learn/docs/angular/06_pipe/>管道</a></li><li><a href=/frontend-learn/docs/angular/07_di/>依赖注入</a></li><li><a href=/frontend-learn/docs/angular/08_service/>服务</a></li><li><a href=/frontend-learn/docs/angular/09_form/>表单</a></li><li><a href=/frontend-learn/docs/angular/10_custom_form/ class=active>自定义表单控件</a></li><li><a href=/frontend-learn/docs/angular/11_router/>路由</a></li><li><a href=/frontend-learn/docs/angular/12_http/>HttpClient</a></li><li><a href=/frontend-learn/docs/angular/13_other/>其他</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/frontend-learn/svg/menu.svg class=book-icon alt=Menu></label>
<strong>自定义表单控件</strong>
<label for=toc-control><img src=/frontend-learn/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#自定义表单控件>自定义表单控件</a></li><li><a href=#实现-controlvalueaccessor-接口>实现 ControlValueAccessor 接口</a></li><li><a href=#实现-validator-接口>实现 Validator 接口</a></li><li><a href=#ng_value_accessor-和-ng_validators>NG_VALUE_ACCESSOR 和 NG_VALIDATORS</a></li></ul></nav></aside></header><article class=markdown><h1 id=自定义表单控件>自定义表单控件
<a class=anchor href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e8%a1%a8%e5%8d%95%e6%8e%a7%e4%bb%b6>#</a></h1><p>创建自定义表单控件时，通常需要三步：</p><ul><li>实现 <code>ControlValueAccessor</code> 接口：使自定义控件能够与 Angular 表单框架配合使用。</li><li>实现 <code>Validator</code> 接口：提供自定义的验证逻辑。</li><li>注册自定义控件为 Angular 表单控件。</li></ul><h1 id=实现-controlvalueaccessor-接口>实现 ControlValueAccessor 接口
<a class=anchor href=#%e5%ae%9e%e7%8e%b0-controlvalueaccessor-%e6%8e%a5%e5%8f%a3>#</a></h1><p><code>ControlValueAccessor</code> 接口允许自定义控件与 Angular 的表单控件（<code>FormControl</code>, <code>ngModel</code>）进行交互。需要实现以下方法：</p><ul><li><code>writeValue(value: any): void</code>：这个方法会将父组件的表单值写入自定义控件。</li><li><code>registerOnChange(fn: any): void</code>：当自定义控件的值发生变化时，调用该方法通知父组件。</li><li><code>registerOnTouched(fn: any): void</code>：当控件被触摸时（比如失去焦点），会调用这个方法通知父组件。通常来说，将 <code>onBlur()</code> 事件会绑定到控件的 <code>blur</code> 事件上，并在 onBlur() 方法中调用它。。</li><li><code>setDisabledState(isDisabled: boolean): void</code>：用于设置控件的禁用状态。可以根据 <code>isDisabled</code> 值来禁用或启用自定义控件。</li></ul><p><code>writeValue</code> 和 <code>setDisabledState</code> 通常在父组件中调用 <code>CustomFormControl.setValue()</code> 和 <code>CustomFormControl.disable()</code> 方法时会执行。父组件初始化控件时也会执行，例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>myCustomCtrl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>({<span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#a6e22e>disabled</span>: <span style=color:#66d9ef>true</span>});
</span></span></code></pre></div><p>实现 <code>ControlValueAccessor</code> 接口示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>forwardRef</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ControlValueAccessor</span>, <span style=color:#a6e22e>NG_VALUE_ACCESSOR</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/forms&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-custom-input&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;input [value]=&#34;value&#34; (input)=&#34;onInput($event)&#34; /&gt;`</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>provide</span>: <span style=color:#66d9ef>NG_VALUE_ACCESSOR</span>, <span style=color:#75715e>// 注册到 Angular 表单系统
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>useExisting</span>: <span style=color:#66d9ef>forwardRef</span>(() <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>CustomInputComponent</span>), <span style=color:#75715e>// 指向当前组件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>multi</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e>// 表示可以有多个实现
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CustomInputComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>ControlValueAccessor</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onChange</span>: <span style=color:#66d9ef>any</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {};
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onTouched</span>: <span style=color:#66d9ef>any</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 实现 ControlValueAccessor 接口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>registerOnChange</span>(<span style=color:#a6e22e>fn</span>: <span style=color:#66d9ef>any</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onChange</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fn</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 也可以直接监听 valueChanges，并通知父组件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// this.control.valueChanges.subscribe(fn); // 当 FormControl 的值变化时，调用回调  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>registerOnTouched</span>(<span style=color:#a6e22e>fn</span>: <span style=color:#66d9ef>any</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onTouched</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fn</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>writeValue</span>(<span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>any</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>value</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setDisabledState</span>(<span style=color:#a6e22e>isDisabled</span>: <span style=color:#66d9ef>boolean</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 可以在这里设置控件的禁用状态
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onInput</span>(<span style=color:#a6e22e>event</span>: <span style=color:#66d9ef>Event</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>target</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>HTMLInputElement</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>onChange</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>value</span>); <span style=color:#75715e>// 通知 Angular 表单模型控件值已经变化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=实现-validator-接口>实现 Validator 接口
<a class=anchor href=#%e5%ae%9e%e7%8e%b0-validator-%e6%8e%a5%e5%8f%a3>#</a></h1><p><code>Validator</code> 接口用于添加自定义的验证逻辑。它定义了一个 <code>validate()</code> 方法，这个方法返回一个 <code>ValidationErrors</code> 对象，或者是 <code>null</code>（表示没有验证错误）。</p><p><code>ValidationErrors</code> 是一个键值对对象，其中每个键表示一个错误类型，值表示错误的详细信息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>AbstractControl</span>, <span style=color:#a6e22e>ValidationErrors</span>, <span style=color:#a6e22e>Validator</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/forms&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-custom-input&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`&lt;input [value]=&#34;value&#34; (input)=&#34;onInput($event)&#34; /&gt;`</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>provide</span>: <span style=color:#66d9ef>NG_VALUE_ACCESSOR</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>useExisting</span>: <span style=color:#66d9ef>forwardRef</span>(() <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>CustomInputComponent</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>multi</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }, 
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>provide</span>: <span style=color:#66d9ef>NG_VALIDATORS</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>useExisting</span>: <span style=color:#66d9ef>forwardRef</span>(() <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>CustomInputComponent</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>multi</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e>// 表示可以有多个验证器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }      
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CustomInputComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>ControlValueAccessor</span>, <span style=color:#a6e22e>Validator</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ControlValueAccessor 接口实现 ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 实现 Validator 接口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>validate</span>(<span style=color:#a6e22e>control</span>: <span style=color:#66d9ef>AbstractControl</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ValidationErrors</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 例如，验证输入值是否为数字
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>control</span>.<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>value</span> <span style=color:#f92672>&amp;&amp;</span> isNaN(<span style=color:#a6e22e>value</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> { <span style=color:#e6db74>&#39;invalidNumber&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;The value must be a number.&#39;</span> };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>; <span style=color:#75715e>// 返回 null 表示验证通过
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>使用自定义表单控件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formGroup</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>myForm</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>app-custom-input</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;customInput&#34;</span>&gt;&lt;/<span style=color:#f92672>app-custom-input</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;myForm.get(&#39;customInput&#39;).hasError(&#39;invalidNumber&#39;)&#34;</span>&gt;
</span></span><span style=display:flex><span>    Value must be a number!
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><h1 id=ng_value_accessor-和-ng_validators>NG_VALUE_ACCESSOR 和 NG_VALIDATORS
<a class=anchor href=#ng_value_accessor-%e5%92%8c-ng_validators>#</a></h1><ul><li><code>NG_VALUE_ACCESSOR</code>：<code>NG_VALUE_ACCESSOR</code> 令牌指向一个实现了 <code>ControlValueAccessor</code> 接口的组件，允许 Angular 在处理表单时使用该组件。<ul><li>表单绑定：<code>NG_VALUE_ACCESSOR</code> 让自定义控件能够与 Angular 表单控件（<code>FormControl</code>, <code>ngModel</code> 等）进行数据绑定。</li><li>双向数据绑定：它允许自定义控件接收表单模型的数据，并将用户的输入传递回表单模型。</li><li>自定义控件集成：通过实现 <code>ControlValueAccessor</code> 接口并提供 <code>NG_VALUE_ACCESSOR</code>，可以将自定义控件集成到 Angular 的表单框架中，享受 Angular 表单系统提供的功能（如验证、状态管理等）。</li></ul></li><li><code>NG_VALIDATORS</code> 主要用于在表单控件上添加自定义的验证逻辑。可以将自定义验证器与 Angular 表单控件（如 <code>FormControl</code>, <code>ngModel</code>）一起使用。</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/shipengqi/frontend-learn/commit/3794de90b5da39af1a7e27a61a4b2da240d72900 title='Last modified by PengQi Shi | December 8, 2024' target=_blank rel=noopener><img src=/frontend-learn/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 8, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/shipengqi/frontend-learn/edit/master/content/docs/angular/10_custom_form.md target=_blank rel=noopener><img src=/frontend-learn/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#自定义表单控件>自定义表单控件</a></li><li><a href=#实现-controlvalueaccessor-接口>实现 ControlValueAccessor 接口</a></li><li><a href=#实现-validator-接口>实现 Validator 接口</a></li><li><a href=#ng_value_accessor-和-ng_validators>NG_VALUE_ACCESSOR 和 NG_VALIDATORS</a></li></ul></nav></div></aside></main></body></html>