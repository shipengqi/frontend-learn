<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="概述 # 在 Angular 中，表单有两种类型，分别为模板驱动表单和响应式表单。
模板驱动表单 # 概述 # 表单的控制逻辑写在组件模板中，适合简单的表单类型。
快速上手 # 引入依赖模块 FormsModule
import { FormsModule } from &#34;@angular/forms&#34; @NgModule({ imports: [FormsModule], }) export class AppModule {} 将 DOM 表单转换为 ngForm
<form #f=&#34;ngForm&#34; (submit)=&#34;onSubmit(f)&#34;></form> 声明表单字段为 ngModel
<form #f=&#34;ngForm&#34; (submit)=&#34;onSubmit(f)&#34;> <input type=&#34;text&#34; name=&#34;username&#34; ngModel /> <button>提交</button> </form> 获取表单字段值
import { NgForm } from &#34;@angular/forms&#34; export class AppComponent { onSubmit(form: NgForm) { console.log(form.value) } } 表单分组
当你的表单的表单项比较多，可以把相关的表单项分组。
<form #f=&#34;ngForm&#34; (submit)=&#34;onSubmit(f)&#34;> <div ngModelGroup=&#34;user&#34;> <input type=&#34;text&#34; name=&#34;username&#34; ngModel /> </div> <div ngModelGroup=&#34;contact&#34;> <input type=&#34;text&#34; name=&#34;phone&#34; ngModel /> </div> <button>提交</button> </form> 分组后，访问表单数据，例如 username，就是 form."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="表单"><meta property="og:description" content="概述 # 在 Angular 中，表单有两种类型，分别为模板驱动表单和响应式表单。
模板驱动表单 # 概述 # 表单的控制逻辑写在组件模板中，适合简单的表单类型。
快速上手 # 引入依赖模块 FormsModule
import { FormsModule } from &#34;@angular/forms&#34; @NgModule({ imports: [FormsModule], }) export class AppModule {} 将 DOM 表单转换为 ngForm
<form #f=&#34;ngForm&#34; (submit)=&#34;onSubmit(f)&#34;></form> 声明表单字段为 ngModel
<form #f=&#34;ngForm&#34; (submit)=&#34;onSubmit(f)&#34;> <input type=&#34;text&#34; name=&#34;username&#34; ngModel /> <button>提交</button> </form> 获取表单字段值
import { NgForm } from &#34;@angular/forms&#34; export class AppComponent { onSubmit(form: NgForm) { console.log(form.value) } } 表单分组
当你的表单的表单项比较多，可以把相关的表单项分组。
<form #f=&#34;ngForm&#34; (submit)=&#34;onSubmit(f)&#34;> <div ngModelGroup=&#34;user&#34;> <input type=&#34;text&#34; name=&#34;username&#34; ngModel /> </div> <div ngModelGroup=&#34;contact&#34;> <input type=&#34;text&#34; name=&#34;phone&#34; ngModel /> </div> <button>提交</button> </form> 分组后，访问表单数据，例如 username，就是 form."><meta property="og:type" content="article"><meta property="og:url" content="http://shipengqi.github.io/frontend-learn/docs/angular/09_form/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-12-08T16:28:03+08:00"><title>表单 | Frontend Learning</title><link rel=manifest href=/frontend-learn/manifest.json><link rel=icon href=/frontend-learn/favicon.png type=image/x-icon><link rel=stylesheet href=/frontend-learn/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/frontend-learn/flexsearch.min.js></script>
<script defer src=/frontend-learn/en.search.min.66b1f569c729b8bb9333a7fef42807ae56aed646360bd401fb7c704d82dc17f6.js integrity="sha256-ZrH1accpuLuTM6f+9CgHrlau1kY2C9QB+3xwTYLcF/Y=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/frontend-learn/><span>Frontend Learning</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://shipengqi.github.io/ target=_blank rel=noopener>Blog</a></li><li><a href=https://github.com/shipengqi/frontend-learn target=_blank rel=noopener>Github</a></li></ul><ul><li><a href=/frontend-learn/docs/html/>HTML 和 CSS</a><ul><li><a href=/frontend-learn/docs/html/01_tags/>HTML 标签</a></li><li><a href=/frontend-learn/docs/html/02_css/>CSS 常用属性</a></li><li><a href=/frontend-learn/docs/html/03_layout/>布局与定位</a></li><li><a href=/frontend-learn/docs/html/04_animation/>过渡和动画</a></li><li><a href=/frontend-learn/docs/html/05_other/>其他属性</a></li><li><a href=/frontend-learn/docs/html/06_selector/>CSS 选择器</a></li><li><a href=/frontend-learn/docs/html/07_responsive/>响应式</a></li><li><a href=/frontend-learn/docs/html/08_svg/>SVG</a></li><li><a href=/frontend-learn/docs/html/09_chrome/>Chrome 开发者工具</a></li></ul></li><li><span>RxJS</span><ul><li><a href=/frontend-learn/docs/rxjs/01_overview/>概念</a></li><li><a href=/frontend-learn/docs/rxjs/02_operators/>操作符</a></li><li><a href=/frontend-learn/docs/rxjs/03_subject/>Subject</a></li><li><a href=/frontend-learn/docs/rxjs/04_practice/>实践</a></li></ul></li><li><span>Angular</span><ul><li><a href=/frontend-learn/docs/angular/01_overview/>概述</a></li><li><a href=/frontend-learn/docs/angular/02_component/>组件模板</a></li><li><a href=/frontend-learn/docs/angular/03_communication/>组件通讯</a></li><li><a href=/frontend-learn/docs/angular/04_lifecycle/>组件生命周期</a></li><li><a href=/frontend-learn/docs/angular/05_directive/>指令</a></li><li><a href=/frontend-learn/docs/angular/06_pipe/>管道</a></li><li><a href=/frontend-learn/docs/angular/07_di/>依赖注入</a></li><li><a href=/frontend-learn/docs/angular/08_service/>服务</a></li><li><a href=/frontend-learn/docs/angular/09_form/ class=active>表单</a></li><li><a href=/frontend-learn/docs/angular/10_custom_form/>自定义表单控件</a></li><li><a href=/frontend-learn/docs/angular/11_router/>路由</a></li><li><a href=/frontend-learn/docs/angular/12_http/>HttpClient</a></li><li><a href=/frontend-learn/docs/angular/13_other/>其他</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/frontend-learn/svg/menu.svg class=book-icon alt=Menu></label>
<strong>表单</strong>
<label for=toc-control><img src=/frontend-learn/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#概述>概述</a></li><li><a href=#模板驱动表单>模板驱动表单</a><ul><li><a href=#概述-1>概述</a></li><li><a href=#快速上手>快速上手</a></li><li><a href=#表单验证>表单验证</a></li></ul></li><li><a href=#响应式表单>响应式表单</a><ul><li><a href=#概述-2>概述</a></li><li><a href=#快速上手-1>快速上手</a></li><li><a href=#formarray>FormArray</a></li><li><a href=#内置表单验证器>内置表单验证器</a></li><li><a href=#自定义同步表单验证器>自定义同步表单验证器</a></li><li><a href=#自定义异步表单验证器>自定义异步表单验证器</a></li><li><a href=#formbuilder>FormBuilder</a></li><li><a href=#其他>其他</a><ul><li><a href=#setvalue>setValue</a></li><li><a href=#patchvalue>patchValue</a></li><li><a href=#reset>reset</a></li><li><a href=#validinvalid>valid、invalid</a></li><li><a href=#dirtypristine>dirty、pristine</a></li><li><a href=#toucheduntouched>touched、untouched</a></li><li><a href=#markastouchedmarkasuntouched>markAsTouched()、markAsUntouched()</a></li><li><a href=#markasdirtymarkaspristine>markAsDirty()、markAsPristine()</a></li><li><a href=#enabledisable>enable()、disable()</a></li><li><a href=#haserror>hasError()</a></li><li><a href=#seterrors>setErrors()</a></li><li><a href=#valuechangesstatuschanges>valueChanges、statusChanges</a></li><li><a href=#updatevalueandvalidity>updateValueAndValidity</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=概述>概述
<a class=anchor href=#%e6%a6%82%e8%bf%b0>#</a></h1><p>在 Angular 中，表单有两种类型，分别为<strong>模板驱动表单</strong>和<strong>响应式表单</strong>。</p><h1 id=模板驱动表单>模板驱动表单
<a class=anchor href=#%e6%a8%a1%e6%9d%bf%e9%a9%b1%e5%8a%a8%e8%a1%a8%e5%8d%95>#</a></h1><h2 id=概述-1>概述
<a class=anchor href=#%e6%a6%82%e8%bf%b0-1>#</a></h2><p>表单的控制逻辑写在组件模板中，适合简单的表单类型。</p><h2 id=快速上手>快速上手
<a class=anchor href=#%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b>#</a></h2><ol><li><p>引入依赖模块 FormsModule</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FormsModule</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@angular/forms&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@NgModule</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>imports</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>FormsModule</span>],
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppModule</span> {}
</span></span></code></pre></div></li><li><p>将 DOM 表单转换为 <code>ngForm</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>f</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ngForm&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>submit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>f</span><span style=color:#960050;background-color:#1e0010>)&#34;</span>&gt;&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div></li><li><p>声明表单字段为 <code>ngModel</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>f</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ngForm&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>submit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>f</span><span style=color:#960050;background-color:#1e0010>)&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> <span style=color:#a6e22e>ngModel</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>button</span>&gt;提交&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div></li><li><p>获取表单字段值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>NgForm</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@angular/forms&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppComponent</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onSubmit</span>(<span style=color:#a6e22e>form</span>: <span style=color:#66d9ef>NgForm</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>表单分组</p><p>当你的表单的表单项比较多，可以把相关的表单项分组。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>f</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ngForm&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>submit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>f</span><span style=color:#960050;background-color:#1e0010>)&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>ngModelGroup</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;user&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> <span style=color:#a6e22e>ngModel</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>ngModelGroup</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;contact&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;phone&#34;</span> <span style=color:#a6e22e>ngModel</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>button</span>&gt;提交&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><p>分组后，访问表单数据，例如 <code>username</code>，就是 <code>form.user.username</code>。</p></li></ol><h2 id=表单验证>表单验证
<a class=anchor href=#%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81>#</a></h2><ul><li><code>required</code> 必填字段</li><li><code>minlength</code> 字段最小长度</li><li><code>maxlength</code> 字段最大长度</li><li><code>pattern</code> 验证正则 例如：<code>pattern="\d"</code> 匹配一个数值</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>f</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ngForm&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>submit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>f</span><span style=color:#960050;background-color:#1e0010>)&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> <span style=color:#a6e22e>ngModel</span> <span style=color:#a6e22e>required</span> <span style=color:#a6e22e>pattern</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;\d&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>button</span>&gt;提交&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppComponent</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onSubmit</span>(<span style=color:#a6e22e>form</span>: <span style=color:#66d9ef>NgForm</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 查看表单整体是否验证通过
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>valid</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- 表单整体未通过验证时禁用提交表单 --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>disabled</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>f</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>invalid</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;提交&lt;/<span style=color:#f92672>button</span>&gt;
</span></span></code></pre></div><p>在组件模板中显示表单项未通过时的错误信息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>f</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ngForm&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>submit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>f</span><span style=color:#960050;background-color:#1e0010>)&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>username</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ngModel&#34;</span> /&gt;
</span></span><span style=display:flex><span>  <span style=color:#75715e>&lt;!-- touched 为 true 表示用户操作过该表单项  --&gt;</span>
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username.touched &amp;&amp; !username.valid &amp;&amp; username.errors&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username.errors.required&#34;</span>&gt;请填写用户名&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username.errors.pattern&#34;</span>&gt;不符合正则规则&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><p><code>dirty</code> 和 <code>touched</code> 都可以用来判断表单控件是否被用户操作过：</p><ul><li><code>dirty</code>：如果用户修改了表单控件的值，则该控件的 <code>dirty</code> 状态会被设置为 <code>true</code>。如果控件的值没有被修改，<code>dirty</code> 状态为 <code>false</code>。</li><li><code>touched</code>：如果控件失去焦点（即用户点击过该控件并离开），则控件的 <code>touched</code> 状态会被设置为 <code>true</code>。</li></ul><p>指定表单项未通过验证时的样式。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#f92672>input</span>.<span style=color:#a6e22e>ng-touched</span>.<span style=color:#a6e22e>ng-invalid</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>border</span>: <span style=color:#ae81ff>2</span><span style=color:#66d9ef>px</span> <span style=color:#66d9ef>solid</span> <span style=color:#66d9ef>red</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=响应式表单>响应式表单
<a class=anchor href=#%e5%93%8d%e5%ba%94%e5%bc%8f%e8%a1%a8%e5%8d%95>#</a></h1><h2 id=概述-2>概述
<a class=anchor href=#%e6%a6%82%e8%bf%b0-2>#</a></h2><p>表单的控制逻辑写在组件类中，对验证逻辑拥有更多的控制权，适合复杂的表单的类型。</p><p>在响应式表单中，表单字段需要是 <code>FormControl</code> 类的实例，实例对象可以验证表单字段中的值，值是否被修改过等等。</p><p><img src="https://github.com/shipengqi/illustrations/blob/e8def83ca9a8a06a545b68d99f871e1b32f15a34/frontend-learn/angular/form-control.jpg?raw=true" alt=form-control></p><p>一组表单字段构成整个表单，整个表单需要是 <code>FormGroup</code> 类的实例，它可以对表单进行整体验证。</p><p><img src="https://github.com/shipengqi/illustrations/blob/e8def83ca9a8a06a545b68d99f871e1b32f15a34/frontend-learn/angular/form-group.jpg?raw=true" alt=form-group></p><ol><li><code>FormControl</code>：表单组中的一个表单项</li><li><code>FormGroup</code>：表单组，表单至少是一个 <code>FormGroup</code></li><li><code>FormArray</code>：用于复杂表单，可以动态添加表单项或表单组，在表单验证时，<code>FormArray</code> 中有一项没通过，那么整体就不会通过。</li></ol><h2 id=快速上手-1>快速上手
<a class=anchor href=#%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b-1>#</a></h2><ol><li><p>引入 <code>ReactiveFormsModule</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ReactiveFormsModule</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@angular/forms&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@NgModule</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>imports</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>ReactiveFormsModule</span>]
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppModule</span> {}
</span></span></code></pre></div></li><li><p>在组件类中创建 <code>FormGroup</code> 表单控制对象</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FormControl</span>, <span style=color:#a6e22e>FormGroup</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@angular/forms&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppComponent</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>contactForm</span>: <span style=color:#66d9ef>FormGroup</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormGroup</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>phone</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>()
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>使用 <code>formGroup</code> 来绑定一组表单控件，使用 <code>formControlName</code> 来绑定每个表单控件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formGroup</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>contactForm</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>submit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>()&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;phone&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>button</span>&gt;提交&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div></li><li><p>获取表单值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppComponent</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>onSubmit() {</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>contactForm</span>.<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>设置表单默认值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>contactForm</span>: <span style=color:#66d9ef>FormGroup</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormGroup</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>(<span style=color:#e6db74>&#34;默认值&#34;</span>),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>phone</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>(<span style=color:#ae81ff>15888888888</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></li><li><p>表单分组</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>contactForm</span>: <span style=color:#66d9ef>FormGroup</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormGroup</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fullName</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormGroup</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>firstName</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>lastName</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>()
</span></span><span style=display:flex><span>  }),
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>phone</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>()
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formGroup</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>contactForm</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>submit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>()&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>formGroupName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;fullName&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;firstName&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;lastName&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;phone&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>button</span>&gt;提交&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>onSubmit() {</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 下面两种方式都可以获取到表单项的值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>contactForm</span>.<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>name</span>.<span style=color:#a6e22e>username</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>contactForm</span>.<span style=color:#66d9ef>get</span>([<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;username&#34;</span>])<span style=color:#f92672>?</span>.<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ol><ul><li><p><code>formControl</code> 指令用于将一个<strong>单独的</strong> <code>FormControl</code> 实例绑定到模板中的表单控件。通常在没有 FormGroup 的情况下使用，适合单独处理一个控件，而不需要嵌套在表单组中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>input</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formControl</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>nameControl</span><span style=color:#960050;background-color:#1e0010>&#34;</span> /&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FormControl</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/forms&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-my-form&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>templateUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./my-form.component.html&#39;</span>,
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyFormComponent</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nameControl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>(<span style=color:#e6db74>&#39;&#39;</span>);  <span style=color:#75715e>// 创建 FormControl 实例
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div></li><li><p><code>formControlName</code> 指令用于将一个<code> FormControl</code> 实例绑定到 <code>FormGroup</code> 中的表单控件。这个指令只能用于<strong>响应式表单</strong>（ReactiveForms），并且<strong>必须与 <code>FormGroup</code> 一起使用</strong>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formGroup</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>form</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name&#34;</span> /&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FormControl</span>, <span style=color:#a6e22e>FormGroup</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/forms&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-my-form&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>templateUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./my-form.component.html&#39;</span>,
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyFormComponent</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>form</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormGroup</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>(<span style=color:#e6db74>&#39;&#39;</span>),  <span style=color:#75715e>// 将 &#39;name&#39; 字段添加到 FormGroup 中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ul><h2 id=formarray>FormArray
<a class=anchor href=#formarray>#</a></h2><p><code>FormArray</code> 是一种特殊类型的 <code>FormGroup</code>，用于管理一组表单控件，通常用于处理动态数量的控件，它允许你动态地添加、移除或更新表单控件。例如，当你需要让用户添加多个相似项（如动态添加多个电子邮件地址、电话号码、或者一组购物车项目）时，<code>FormArray</code> 是理想的选择。</p><p>例如实现一个表单，允许用户输入多个电子邮件地址：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FormBuilder</span>, <span style=color:#a6e22e>FormGroup</span>, <span style=color:#a6e22e>FormArray</span>, <span style=color:#a6e22e>Validators</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/forms&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-dynamic-form&#39;</span>,
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>templateUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./dynamic-form.component.html&#39;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DynamicFormComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>emailForm</span>: <span style=color:#66d9ef>FormGroup</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>fb</span>: <span style=color:#66d9ef>FormBuilder</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>ngOnInit</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>emailForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fb</span>.<span style=color:#a6e22e>group</span>({
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>emails</span>: <span style=color:#66d9ef>this.fb.array</span>([<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>createEmailControl</span>()])
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 创建单个电子邮件控件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#a6e22e>createEmailControl</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>FormGroup</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fb</span>.<span style=color:#a6e22e>group</span>({
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;&#39;</span>, [<span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>required</span>, <span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>email</span>]]
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 获取 FormArray
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#66d9ef>get</span> <span style=color:#a6e22e>emailControls</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>FormArray</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>emailForm</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>&#39;emails&#39;</span>) <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>FormArray</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 添加新的电子邮件控件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#a6e22e>addEmail() {</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>emailControls</span>.<span style=color:#a6e22e>push</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>createEmailControl</span>());
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 删除指定索引的电子邮件控件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#a6e22e>removeEmail</span>(<span style=color:#a6e22e>index</span>: <span style=color:#66d9ef>number</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>emailControls</span>.<span style=color:#a6e22e>removeAt</span>(<span style=color:#a6e22e>index</span>);
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 提交表单数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#a6e22e>onSubmit() {</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>emailForm</span>.<span style=color:#a6e22e>valid</span>) {
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>emailForm</span>.<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Form is invalid&#39;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>emailForm</code> 是一个包含 <code>emails</code> 的表单组，<code>emails</code> 是一个 <code>FormArray</code>。
<code>createEmailControl()</code> 是一个方法，用来创建一个带有电子邮件验证的 <code>FormGroup</code>。
<code>emailControls</code> 是一个 <code>getter</code>，用来获取 <code>FormArray</code>。
<code>addEmail()</code> 方法用于动态添加新的电子邮件控件到 <code>FormArray</code>。
<code>removeEmail(index)</code> 方法用于删除指定索引的控件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formGroup</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>emailForm</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>ngSubmit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>()&#34;</span>&gt;
</span></span><span style=display:flex><span>   &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>formArrayName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;emails&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngFor</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;let email of emailControls.controls; let i = index&#34;</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formGroupName</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>i</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;
</span></span><span style=display:flex><span>         &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email{{ i }}&#34;</span>&gt;Email {{ i + 1 }}:&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>         &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email{{ i }}&#34;</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email&#34;</span> /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;button&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>click</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>removeEmail</span><span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>i</span><span style=color:#960050;background-color:#1e0010>)&#34;</span>&gt;Remove&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email.get(&#39;email&#39;).invalid &amp;&amp; email.get(&#39;email&#39;).touched&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>small</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email.get(&#39;email&#39;).hasError(&#39;required&#39;)&#34;</span>&gt;Email is required.&lt;/<span style=color:#f92672>small</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>small</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email.get(&#39;email&#39;).hasError(&#39;email&#39;)&#34;</span>&gt;Invalid email format.&lt;/<span style=color:#f92672>small</span>&gt;
</span></span><span style=display:flex><span>         &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>   &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;button&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>click</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>addEmail</span><span style=color:#960050;background-color:#1e0010>()&#34;</span>&gt;Add Email&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>   &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>disabled</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>emailForm</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>invalid</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;Submit&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><ul><li><code>formArrayName="emails"</code>：将 <code>FormArray</code> 与模板中的对应部分绑定。</li><li><code>*ngFor</code>：遍历 <code>FormArray</code> 中的每个表单控件。</li><li><code>formControlName="email"</code>：为每个表单控件（电子邮件输入框）绑定一个 <code>FormControl</code>。</li><li><code>addEmail()</code>：点击 &ldquo;Add Email&rdquo; 按钮时，调用 <code>addEmail()</code> 方法来向表单中添加一个新的电子邮件输入框。</li><li><code>removeEmail(i)</code>：点击 &ldquo;Remove&rdquo; 按钮时，调用 <code>removeEmail()</code> 方法来从表单中删除指定的电子邮件输入框。</li></ul><h2 id=内置表单验证器>内置表单验证器
<a class=anchor href=#%e5%86%85%e7%bd%ae%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e5%99%a8>#</a></h2><ol><li><p>使用内置验证器提供的验证规则验证表单字段</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FormControl</span>, <span style=color:#a6e22e>FormGroup</span>, <span style=color:#a6e22e>Validators</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@angular/forms&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>contactForm</span>: <span style=color:#66d9ef>FormGroup</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormGroup</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>(<span style=color:#e6db74>&#34;默认值&#34;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>required</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>minLength</span>(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>  ])
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></li><li><p>获取整体表单是否验证通过</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>onSubmit() {</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>contactForm</span>.<span style=color:#a6e22e>valid</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!-- 表单整体未验证通过时禁用表单按钮 --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>button</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>disabled</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>contactForm</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>invalid</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;提交&lt;/<span style=color:#f92672>button</span>&gt;
</span></span></code></pre></div></li><li><p>在组件模板中显示为验证通过时的错误信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>get</span> <span style=color:#a6e22e>name() {</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>contactForm</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>&#34;name&#34;</span>)<span style=color:#f92672>!</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formGroup</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>contactForm</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>submit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>()&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name.touched &amp;&amp; name.invalid &amp;&amp; name.errors&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name.errors.required&#34;</span>&gt;请填写姓名&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name.errors.maxlength&#34;</span>&gt;
</span></span><span style=display:flex><span>      姓名长度不能大于
</span></span><span style=display:flex><span>      {{ name.errors.maxlength.requiredLength }} 实际填写长度为
</span></span><span style=display:flex><span>      {{ name.errors.maxlength.actualLength }}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div></li></ol><h2 id=自定义同步表单验证器>自定义同步表单验证器
<a class=anchor href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%90%8c%e6%ad%a5%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e5%99%a8>#</a></h2><ol><li>自定义验证器的类型是 TypeScript 类</li><li>类中包含具体的验证方法，验证方法必须为静态方法</li><li>验证方法有一个参数 control，类型为 <code>AbstractControl</code>。其实就是 <code>FormControl</code> 类的实例对象的类型</li><li>如果验证成功，返回 <code>null</code></li><li>如果验证失败，返回对象，对象中的属性即为验证标识，值为 <code>true</code>，标识该项验证失败</li><li>验证方法的返回值为 <code>ValidationErrors | null</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>AbstractControl</span>, <span style=color:#a6e22e>ValidationErrors</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@angular/forms&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NameValidators</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 字段值中不能包含空格
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>static</span> <span style=color:#a6e22e>cannotContainSpace</span>(<span style=color:#a6e22e>control</span>: <span style=color:#66d9ef>AbstractControl</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ValidationErrors</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 验证未通过
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>/\s/</span>.<span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>control</span>.<span style=color:#a6e22e>value</span>)) <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>cannotContainSpace</span>: <span style=color:#66d9ef>true</span> }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 验证通过
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>NameValidators</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./Name.validators&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>contactForm</span>: <span style=color:#66d9ef>FormGroup</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormGroup</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FormControl</span>(<span style=color:#e6db74>&#34;&#34;</span>, [
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>required</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>NameValidators</span>.<span style=color:#a6e22e>cannotContainSpace</span>
</span></span><span style=display:flex><span>  ])
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name.touched &amp;&amp; name.invalid &amp;&amp; name.errors&#34;</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name.errors.cannotContainSpace&#34;</span>&gt;姓名中不能包含空格&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span></code></pre></div><h2 id=自定义异步表单验证器>自定义异步表单验证器
<a class=anchor href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%bc%82%e6%ad%a5%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e5%99%a8>#</a></h2><p>异步验证器函数：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Injectable</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>HttpClient</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/common/http&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Observable</span>, <span style=color:#66d9ef>of</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;rxjs&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>debounceTime</span>, <span style=color:#a6e22e>map</span>, <span style=color:#a6e22e>catchError</span>, <span style=color:#a6e22e>switchMap</span>, <span style=color:#a6e22e>take</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;rxjs/operators&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>AbstractControl</span>, <span style=color:#a6e22e>AsyncValidatorFn</span>, <span style=color:#a6e22e>ValidationErrors</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/forms&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Injectable</span>({
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>providedIn</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;root&#39;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmailValidatorService</span> {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>http</span>: <span style=color:#66d9ef>HttpClient</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 异步验证器：检查邮箱是否已注册
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#a6e22e>emailExistsValidator</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>AsyncValidatorFn</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>control</span>: <span style=color:#66d9ef>AbstractControl</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Observable</span>&lt;<span style=color:#f92672>ValidationErrors</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>null</span>&gt; <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>control</span>.<span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>of</span>(<span style=color:#66d9ef>null</span>); <span style=color:#75715e>// 如果控件值为空，不做验证
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>         }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#75715e>// 返回 Observable，模拟 HTTP 请求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>         <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>http</span>.<span style=color:#66d9ef>get</span>&lt;<span style=color:#f92672>any</span>&gt;(<span style=color:#e6db74>`/api/check-email?email=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>control</span>.<span style=color:#a6e22e>value</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>).<span style=color:#a6e22e>pipe</span>(
</span></span><span style=display:flex><span>                 <span style=color:#a6e22e>debounceTime</span>(<span style=color:#ae81ff>500</span>), <span style=color:#75715e>// 防止发送过多请求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                 <span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>response</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                    <span style=color:#75715e>// 假设 response 存在 `exists` 字段，表示邮箱是否已经存在
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>exists</span> <span style=color:#f92672>?</span> { <span style=color:#a6e22e>emailExists</span>: <span style=color:#66d9ef>true</span> } <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>                 }),
</span></span><span style=display:flex><span>                 <span style=color:#a6e22e>catchError</span>(() <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>of</span>(<span style=color:#66d9ef>null</span>)) <span style=color:#75715e>// 如果发生错误（如网络请求失败），返回 null
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>         );
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>AsyncValidatorFn</code>：这是异步验证器的类型，它返回一个 <code>Observable</code> 或 <code>Promise</code>，并且必须解析为 <code>ValidationErrors</code>（验证失败时）或 <code>null</code>（验证通过）。</li><li><code>debounceTime</code>：这是防止发送过多请求的技巧，尤其是在用户输入过程中。通常，在输入停止一段时间后再发起验证请求。</li><li><code>catchError</code>：如果网络请求失败或出现错误，返回 <code>null</code> 表示验证成功。</li></ul><p>在组件中使用异步验证器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>OnInit</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FormBuilder</span>, <span style=color:#a6e22e>FormGroup</span>, <span style=color:#a6e22e>Validators</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@angular/forms&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>EmailValidatorService</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./email-validator.service&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>@Component</span>({
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;app-user-form&#39;</span>,
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>templateUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;./user-form.component.html&#39;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserFormComponent</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>OnInit</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>userForm</span>: <span style=color:#66d9ef>FormGroup</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>constructor</span>(
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>fb</span>: <span style=color:#66d9ef>FormBuilder</span>,
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>emailValidator</span>: <span style=color:#66d9ef>EmailValidatorService</span>
</span></span><span style=display:flex><span>   ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>ngOnInit</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>userForm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fb</span>.<span style=color:#a6e22e>group</span>({
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>            [<span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>required</span>, <span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>email</span>],
</span></span><span style=display:flex><span>            [<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>emailValidator</span>.<span style=color:#a6e22e>emailExistsValidator</span>()]
</span></span><span style=display:flex><span>         ]
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>onSubmit</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>userForm</span>.<span style=color:#a6e22e>valid</span>) {
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>userForm</span>.<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Form is invalid&#39;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>emailExistsValidator()</code>：这是在 <code>EmailValidatorService</code> 中定义的异步验证器，用于验证用户输入的电子邮件地址是否已存在。</li><li><code>[this.emailValidator.emailExistsValidator()]</code>：将异步验证器作为第三个参数传递给 <code>FormControl</code>，它会在表单控件的值变化时触发。</li><li><code>FormControl</code> 的验证顺序：<code>Validators.required</code> 和 <code>Validators.email</code> 是同步验证器，而 <code>emailExistsValidator()</code> 是异步验证器。</li></ul><p>模板代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>formGroup</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>userForm</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>ngSubmit</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>onSubmit</span><span style=color:#960050;background-color:#1e0010>()&#34;</span>&gt;
</span></span><span style=display:flex><span>   &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email&#34;</span>&gt;Email:&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email&#34;</span> <span style=color:#a6e22e>formControlName</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email&#34;</span> /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>&lt;!-- 错误消息 --&gt;</span>
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;userForm.get(&#39;email&#39;).hasError(&#39;required&#39;) &amp;&amp; userForm.get(&#39;email&#39;).touched&#34;</span>&gt;
</span></span><span style=display:flex><span>         Email is required.
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;userForm.get(&#39;email&#39;).hasError(&#39;email&#39;) &amp;&amp; userForm.get(&#39;email&#39;).touched&#34;</span>&gt;
</span></span><span style=display:flex><span>         Invalid email format.
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#960050;background-color:#1e0010>*</span><span style=color:#a6e22e>ngIf</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;userForm.get(&#39;email&#39;).hasError(&#39;emailExists&#39;) &amp;&amp; userForm.get(&#39;email&#39;).touched&#34;</span>&gt;
</span></span><span style=display:flex><span>         This email address is already registered.
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>   &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#960050;background-color:#1e0010>[</span><span style=color:#a6e22e>disabled</span><span style=color:#960050;background-color:#1e0010>]=&#34;</span><span style=color:#a6e22e>userForm</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>invalid</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;Submit&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;
</span></span></code></pre></div><h2 id=formbuilder>FormBuilder
<a class=anchor href=#formbuilder>#</a></h2><p><code>FormBuilder</code> 是一个辅助工具，用于简化和减少 <code>FormControl</code> 和 <code>FormGroup</code> 的冗长创建过程，特别是在需要创建大量表单控件时。通过 <code>FormBuilder</code>，可以更简洁、更易读地构建表单。</p><ol><li><code>this.fb.control</code>：表单项</li><li><code>this.fb.group</code>：表单组，表单至少是一个 <code>FormGroup</code></li><li><code>this.fb.array</code>：用于复杂表单，可以动态添加表单项或表单组，在表单验证时，<code>FormArray</code> 中有一项没通过，那么整体就不会通过。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>form</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fb</span>.<span style=color:#a6e22e>group</span>({
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>required</span>],
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;&#39;</span>, [<span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>required</span>, <span style=color:#a6e22e>Validators</span>.<span style=color:#a6e22e>email</span>]],
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h2 id=其他>其他
<a class=anchor href=#%e5%85%b6%e4%bb%96>#</a></h2><h3 id=setvalue>setValue
<a class=anchor href=#setvalue>#</a></h3><p>用于将<strong>整个表单控件</strong>的值设置为一个新的值。如果你使用 <code>setValue</code>，必须提供一个完整的对象，该对象必须包含所有控件的值，且顺序和控件名必须与原始表单控件匹配。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>formGroup</span>.<span style=color:#a6e22e>setValue</span>(<span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> { [<span style=color:#a6e22e>key</span>: <span style=color:#66d9ef>string</span>]<span style=color:#f92672>:</span> <span style=color:#66d9ef>any</span> }, <span style=color:#a6e22e>options</span><span style=color:#f92672>?:</span> { <span style=color:#a6e22e>onlySelf?</span>: <span style=color:#66d9ef>boolean</span>, <span style=color:#a6e22e>emitEvent?</span>: <span style=color:#66d9ef>boolean</span> })
</span></span></code></pre></div><ul><li><code>value</code>：一个包含所有控件的值的对象，必须包含表单中所有控件的值。</li><li><code>onlySelf</code>（可选）：如果为 <code>true</code>，则只会更新当前控件的值，不会影响父表单。</li><li><code>emitEvent</code>（可选）：如果为 <code>false</code>，则不会触发控件的 <code>valueChanges</code> 事件。</li></ul><h3 id=patchvalue>patchValue
<a class=anchor href=#patchvalue>#</a></h3><p><code>patchValue</code> 方法与 <code>setValue</code> 类似，也用于更新表单控件的值。但是，<code>patchValue</code> 允许<strong>部分更新</strong>表单控件的值。你只需要提供你希望更新的控件的值，而不必提供整个表单控件的值。这对于动态表单或者只需更新部分控件的场景非常有用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>formGroup</span>.<span style=color:#a6e22e>patchValue</span>(<span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> { [<span style=color:#a6e22e>key</span>: <span style=color:#66d9ef>string</span>]<span style=color:#f92672>:</span> <span style=color:#66d9ef>any</span> }, <span style=color:#a6e22e>options</span><span style=color:#f92672>?:</span> { <span style=color:#a6e22e>onlySelf?</span>: <span style=color:#66d9ef>boolean</span>, <span style=color:#a6e22e>emitEvent?</span>: <span style=color:#66d9ef>boolean</span> })
</span></span></code></pre></div><ul><li><code>value</code>：一个包含部分控件值的对象，更新该对象中的字段，不需要提供所有控件的值。</li><li><code>onlySelf</code>（可选）：如果为 <code>true</code>，则只会更新当前控件的值，不会影响父表单。</li><li><code>emitEvent</code>（可选）：如果为 <code>false</code>，则不会触发控件的 <code>valueChanges</code> 事件。</li></ul><h3 id=reset>reset
<a class=anchor href=#reset>#</a></h3><p>方法用于将表单恢复到初始状态。可以通过它将控件值重置为初始值，并恢复表单的有效性。</p><h3 id=validinvalid>valid、invalid
<a class=anchor href=#validinvalid>#</a></h3><p>这两个属性用来检查表单是否有效。<code>valid</code> 返回 <code>true</code> 如果表单是有效的，<code>invalid</code> 返回 <code>true</code> 如果表单是无效的。</p><h3 id=dirtypristine>dirty、pristine
<a class=anchor href=#dirtypristine>#</a></h3><ul><li><code>dirty</code>：如果控件的值已经被修改，则返回 <code>true</code>，否则返回 <code>false</code>。</li><li><code>pristine</code>：与 <code>dirty</code> 相反，如果控件的值从未被修改过，则返回<code> true</code>。</li></ul><h3 id=toucheduntouched>touched、untouched
<a class=anchor href=#toucheduntouched>#</a></h3><ul><li><code>touched</code>：如果控件已经被触摸（即用户离开了该控件），则返回 <code>true</code>。</li><li><code>untouched</code>：如果控件未被触摸，则返回 <code>true</code>。</li></ul><h3 id=markastouchedmarkasuntouched>markAsTouched()、markAsUntouched()
<a class=anchor href=#markastouchedmarkasuntouched>#</a></h3><ul><li><code>markAsTouched()</code>：将所有控件标记为已触摸。</li><li><code>markAsUntouched()</code>：将所有控件标记为未触摸。</li></ul><h3 id=markasdirtymarkaspristine>markAsDirty()、markAsPristine()
<a class=anchor href=#markasdirtymarkaspristine>#</a></h3><ul><li><code>markAsDirty()</code>：将所有控件标记为已修改。</li><li><code>markAsPristine()</code>：将所有控件标记为未修改。</li></ul><h3 id=enabledisable>enable()、disable()
<a class=anchor href=#enabledisable>#</a></h3><ul><li><code>enable()</code>：启用表单控件。</li><li><code>disable()</code>：禁用表单控件。</li></ul><h3 id=haserror>hasError()
<a class=anchor href=#haserror>#</a></h3><p><code>hasError()</code> 用于检查控件是否存在特定的验证错误。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>formGroup</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>&#39;email&#39;</span>).<span style=color:#a6e22e>hasError</span>(<span style=color:#e6db74>&#39;required&#39;</span>)) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Email is required&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=seterrors>setErrors()
<a class=anchor href=#seterrors>#</a></h3><p><code>setErrors()</code> 将控件设置错误，并且可以指定一个错误对象。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>formGroup</span>.<span style=color:#a6e22e>setErrors</span>(<span style=color:#a6e22e>errors</span>: <span style=color:#66d9ef>ValidationErrors</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>, <span style=color:#a6e22e>options</span><span style=color:#f92672>?:</span> { <span style=color:#a6e22e>emitEvent?</span>: <span style=color:#66d9ef>boolean</span> })<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span>
</span></span></code></pre></div><ul><li><code>errors</code>：一个包含错误信息的对象，或者为 <code>null</code>，表示清除所有错误。<code>ValidationErrors</code> 是一个键值对对象，键是错误的名称，值是错误的描述信息。</li><li><code>options.emitEvent</code>（可选）：一个布尔值，表示是否触发 <code>statusChanges</code> 和 <code>valueChanges</code> 事件。默认为 <code>true</code>，即触发事件。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>formGroup</span>.<span style=color:#a6e22e>setErrors</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>invalidForm</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;The form is invalid&#39;</span>
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h3 id=valuechangesstatuschanges>valueChanges、statusChanges
<a class=anchor href=#valuechangesstatuschanges>#</a></h3><ul><li><code>valueChanges</code>：当表单控件的值发生变化时（例如 <code>setValue()</code>），会触发该 <code>Observable</code>。</li><li><code>statusChanges</code>：当表单控件的状态发生变化时（例如从 <code>valid</code> 到 <code>invalid</code>，或者调用 <code>setErrors()</code>），会触发该 <code>Observable</code>。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>formGroup</span>.<span style=color:#a6e22e>valueChanges</span>.<span style=color:#a6e22e>subscribe</span>(<span style=color:#a6e22e>value</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Form value changed:&#39;</span>, <span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>formGroup</span>.<span style=color:#a6e22e>statusChanges</span>.<span style=color:#a6e22e>subscribe</span>(<span style=color:#a6e22e>status</span> <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Form status changed:&#39;</span>, <span style=color:#a6e22e>status</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h3 id=updatevalueandvalidity>updateValueAndValidity
<a class=anchor href=#updatevalueandvalidity>#</a></h3><p>用于<strong>更新表单控件的值和有效性</strong>。它会触发控件的验证过程，重新评估控件的值是否有效，并更新控件的验证状态（如 <code>valid、invalid、pending、touched</code> 等）。</p><p>这个方法在你手动修改控件的值或验证器时特别有用，确保控件的状态得到重新评估。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#a6e22e>formControl</span>.<span style=color:#a6e22e>updateValueAndValidity</span>(<span style=color:#a6e22e>options</span><span style=color:#f92672>?:</span> { <span style=color:#a6e22e>onlySelf?</span>: <span style=color:#66d9ef>boolean</span>, <span style=color:#a6e22e>emitEvent?</span>: <span style=color:#66d9ef>boolean</span> })<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span>
</span></span></code></pre></div><ul><li><code>onlySelf</code>（可选）：如果为 <code>true</code>，仅会更新当前控件，而不会影响父表单。默认为 <code>false</code>，即更新当前控件及其父控件。</li><li><code>emitEvent</code>（可选）：如果为 <code>false</code>，则不会触发 <code>valueChanges</code> 或 <code>statusChanges</code> 事件。默认为 <code>true</code>，即会触发这些事件。</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/shipengqi/frontend-learn/commit/3794de90b5da39af1a7e27a61a4b2da240d72900 title='Last modified by PengQi Shi | December 8, 2024' target=_blank rel=noopener><img src=/frontend-learn/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 8, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/shipengqi/frontend-learn/edit/master/content/docs/angular/09_form.md target=_blank rel=noopener><img src=/frontend-learn/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#概述>概述</a></li><li><a href=#模板驱动表单>模板驱动表单</a><ul><li><a href=#概述-1>概述</a></li><li><a href=#快速上手>快速上手</a></li><li><a href=#表单验证>表单验证</a></li></ul></li><li><a href=#响应式表单>响应式表单</a><ul><li><a href=#概述-2>概述</a></li><li><a href=#快速上手-1>快速上手</a></li><li><a href=#formarray>FormArray</a></li><li><a href=#内置表单验证器>内置表单验证器</a></li><li><a href=#自定义同步表单验证器>自定义同步表单验证器</a></li><li><a href=#自定义异步表单验证器>自定义异步表单验证器</a></li><li><a href=#formbuilder>FormBuilder</a></li><li><a href=#其他>其他</a><ul><li><a href=#setvalue>setValue</a></li><li><a href=#patchvalue>patchValue</a></li><li><a href=#reset>reset</a></li><li><a href=#validinvalid>valid、invalid</a></li><li><a href=#dirtypristine>dirty、pristine</a></li><li><a href=#toucheduntouched>touched、untouched</a></li><li><a href=#markastouchedmarkasuntouched>markAsTouched()、markAsUntouched()</a></li><li><a href=#markasdirtymarkaspristine>markAsDirty()、markAsPristine()</a></li><li><a href=#enabledisable>enable()、disable()</a></li><li><a href=#haserror>hasError()</a></li><li><a href=#seterrors>setErrors()</a></li><li><a href=#valuechangesstatuschanges>valueChanges、statusChanges</a></li><li><a href=#updatevalueandvalidity>updateValueAndValidity</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>